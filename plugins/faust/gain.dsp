import("stdfaust.lib");

od1(g) = _ : fi.iir((B0 / A0, B1 / A0, B2 / A0), (A1 / A0, A2 / A0)) : _
with {
    K = 2 * ma.SR;

    B0 = 0.00916582638188652*K*g;
    B1 = 0;
    B2 = -0.00916582638188652*K*g;

    A0 = 4.30793839948666e-8*pow(K, 2)*g + 2.35e-5*K*g +
        0.000916582638188652*K + 0.5;
    A1 = -8.61587679897332e-8*pow(K, 2)*g + 1.0;
    A2 = 4.30793839948666e-8*pow(K, 2)*g - 2.35e-5*K*g -
        0.000916582638188652*K + 0.5;
};

od2(g) = _ : fi.iir((B0 / A0, B1 / A0, B2 / A0), (A1 / A0, A2 / A0)) : _
with {
    K = 2 * ma.SR;

    B0 = 0.11*K*g;
    B1 = 0;
    B2 = -0.11*K*g;

    A0 = 4.69953e-8*pow(K, 2)*g + 2.35e-5*K*g + 0.0009999*K + 0.5;
    A1 = -9.39906e-8*pow(K, 2)*g + 1.0;
    A2 = 4.69953e-8*pow(K, 2)*g - 2.35e-5*K*g - 0.0009999*K + 0.5;
};

gain(g, channel) = _ <: od1(g),od2(g) : si.interpolate(channel) : _;
